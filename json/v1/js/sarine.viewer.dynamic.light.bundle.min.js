/*! sarine.viewer.dynamic.light - v0.0.1 -  2015-02-09 */
(function(){var t,n,r={}.hasOwnProperty,i=function(n,t){function u(){this.constructor=n}for(var i in t)r.call(t,i)&&(n[i]=t[i]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=function(){function n(t){this.first_init_defer=$.Deferred();this.full_init_defer=$.Deferred();this.src=t.src;this.element=t.element;this.autoPlay=t.autoPlay;this.id=this.element[0].id;this.element=this.convertElement();Object.getOwnPropertyNames(n.prototype).forEach(function(n){if(this[n].name==="Error")return console.error(this.id,n,"Must be implement",this)},this);this.element.data("class",this);this.element.on("play",function(n){return $(n.target).data("class").play.apply($(n.target).data("class"),[!0])});this.element.on("stop",function(n){return $(n.target).data("class").stop.apply($(n.target).data("class"),[!0])});this.element.on("cancel",function(n){return $(n.target).data("class").cancel().apply($(n.target).data("class"),[!0])})}var i,t;return t=ResourceManager.getInstance(),i=function(){return console.error(this.id,"must be implement")},n.prototype.first_init=Error,n.prototype.full_init=Error,n.prototype.play=Error,n.prototype.stop=Error,n.prototype.convertElement=Error,n.prototype.cancel=function(){return t.cancel(this)},n.prototype.loadImage=function(n){return t.loadImage.apply(this,[n])},n.prototype.setTimeout=function(){return t.setTimeout.apply(this,[this.delay])},n}();console.log("");this.Viewer=n;n.Dynamic=function(t){function r(t){r.__super__.constructor.call(this,t);this.delay=50;Object.getOwnPropertyNames(n.Dynamic.prototype).forEach(function(n){if(this[n].name==="Error")return console.error(this.id,n,"Must be implement",this)},this)}return i(r,t),r.playing=!1,r.prototype.nextImage=Error,r.prototype.play=function(n){var t;return n&&(this.playing=!0),this.nextImage.apply(this),this.playing?(t=this,this.setTimeout(this.delay).then(t.play)):void 0},r.prototype.stop=function(){return this.playing=!1},r}(n);t=function(n){function t(n){var u,i;for(t.__super__.constructor.call(this,n),this.sliceDownload=n.sliceDownload,this.sliceDownload=this.sliceDownload|3,this.imagesArr={},this.downloadImagesArr={},this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),u=i=0;0<=r?i<=r:i>=r;u=0<=r?++i:--i)this.imagesArr[u]=void 0}var s,r,u,f,h,e,c,o,l,a;return i(t,n),r=48,h=0,s={},e={},f={},c=!0,o=100,a=100,l=0,u=1,t.prototype.convertElement=function(){return this.canvas=$("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this.element.append(this.canvas)},t.prototype.first_init=function(){var n,t;return n=this.first_init_defer,n.notify(this.id+" : start load first image"),t=this,this.loadImage(this.src+"00.png").then(function(i){return t.canvas.attr({width:i.width,height:i.height}),t.ctx.drawImage(i,0,0),n.resolve()}),n},t.prototype.loadParts=function(n,t){var s,u,i;return n=n||0,t=t||$.Deferred(),s=[],i=this,$.when.apply($,function(){var t,e,r,f;for(r=function(){var t,f,i,r;for(i=Object.getOwnPropertyNames(this.imagesArr),r=[],t=0,f=i.length;t<f;t++)u=i[t],(u+n)%this.sliceDownload==0&&r.push(u);return r}.call(this),f=[],t=0,e=r.length;t<e;t++)u=r[t],f.push(function(n){return i.loadImage(i.src+(n<10?"0"+n:n)+".png").then(function(n){return s.push(n)})}(u));return f}.call(this)).then(function(){var h,c,u,l;for(c=function(n){var t;return t=parseInt(n.src.match(/\d+(?=.png)/)[0]),f[t]=e[t]=n},u=0,l=s.length;u<l;u++)h=s[u],c(h);return Object.getOwnPropertyNames(e).length===r+1?t.resolve():i.loadParts(++n,t),i.delay=i.sliceDownload/n*o}),t},t.prototype.full_init=function(){var n;return n=this.full_init_defer,n.notify(this.id+" : start load all images"),this.loadParts(),n},t.prototype.nextImage=function(){var n;return n=Object.getOwnPropertyNames(f).map(function(n){return parseInt(n)}),n.length>1?(this.ctx.drawImage(f[n[u]],0,0),u=(u+1)%n.length):void 0},t}(n.Dynamic);this.Light=t}).call(this);
//# sourceMappingURL=sarine.viewer.dynamic.light.min.js.map
