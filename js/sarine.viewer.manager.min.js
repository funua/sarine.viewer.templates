(function(){var n;n=function(){function n(n){e=n.fromTag;h=n.toTag;stoneViews=n.stoneViews;i=n.template;s=stoneViews.viewersBaseUrl+"{version}/js/";o=stoneViews.viewersBaseUrl+"{version}/jsons/";viewers=[];this.bind=n.template?a:r}var c,r,l,u,f,e,t,o,a,v,s,stoneViews,i,h,viewers;return viewers=[],stoneViews=void 0,e=void 0,h=void 0,stoneViews=void 0,i=void 0,o=void 0,s=void 0,v=void 0,f=[],n.prototype.bind=Error,t=function(n){var t;return t=n.split("/"),t.pop(),t.join("/")},r=function(n){var t;return t=$.Deferred(),$(n).find(e).each(function(){return function(n,t){var i,r,u;return i=$("<"+h+">"),r=$(t).attr("viewer"),u=$(t).attr("version"),i.data("type",r),i.data("version",u),i.addClass("viewer "+r),i.attr("id","viewr_"+n),$(t).replaceWith(i),f.push(c(r,i))}}(this)),$.when.apply($,f).done(t.resolve),t},a=function(n){var f,u;return f=$.Deferred(),u=[],$("<div>").load(i,function(e){return $(n).prepend($(e).each(function(){return function(e,o){return o.tagName==="SCRIPT"&&o.src&&(u.push($.Deferred()),o.src=o.src.replace(t(location.origin+location.pathname),t(i)),$.getScript(o.src,function(){return u.pop(),u.length===0?r(n).then(function(){return f.resolve()}):void 0}),$(o).remove()),o.tagName==="LINK"&&o.href?o.href=o.href.replace(t(location.origin+location.pathname),t(i)):void 0}}(this))),$(n).find("*[data-sarine-info]").each(function(){return function(n,t){var i;return i=$(t),i.text(l(stones[0],i.data("sarineInfo")))}}(this)),u.length===0?r(n).then(f.resolve):void 0}),f.then(function(){return $(document).trigger("loadTemplate")})},c=function(type,toElement){var data,defer;return defer=$.Deferred(),data=void 0,$.ajaxSetup({async:!1}),$.getJSON(o.replace("{version}",toElement.data("version")||"v1")+type+".json",function(){return function(n){return data=n}}(this)),$.ajaxSetup({async:!0}),$.getScript(s.replace("{version}",toElement.data("version")||"v1")+data.name+(location.hash.indexOf("debug")===1?".bundle.js":".bundle.min.js")).then(function(){return function(){var inst;return inst=eval(data.instance),viewers.push(new inst($.extend({src:stoneViews.viewers[type],element:toElement},data.args))),defer.resolve()}}(this)),defer},l=function(n,t){return u(n,t.split("."))},u=function(n,t){return t.length===0?n:n?u(n[t.shift()],t):void 0},n.prototype.getViewers=function(){return viewers},n.prototype.first_init=function(){var n,t;return n=$.Deferred(),t=[],viewers.forEach(function(n){return t.push(n.first_init())}),$.when.apply($,t).done(n.resolve),n},n.prototype.full_init=function(){var n;return n=$.Deferred(),viewers.forEach(function(n){return n.full_init()}),$.when.apply($,viewers.map(function(n){return n.full_init_defer})).done(n.resolve),n},n.prototype.stop=function(){return viewers.forEach(function(n){return n.stop()})},n.prototype.play=function(){return viewers.forEach(function(n){return n.play(!0)})},n}();this.ViewerManger=n}).call(this);
//# sourceMappingURL=sarine.viewer.manager.min.js.map
